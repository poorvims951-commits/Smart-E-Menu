<script>
// üîê Simple Kitchen Staff Login (runs before page loads)
if (!localStorage.getItem("kitchenAuth")) {
  const user = prompt("Enter Kitchen Username:");
  const pass = prompt("Enter Kitchen Password:");
  
  // ‚úÖ Hardcoded credentials (change as needed)
  if (user === "kitchen" && pass === "1234") {
    localStorage.setItem("kitchenAuth", "true");
  } else {
    alert("Unauthorized! Wrong username or password.");
    window.location.href = "/"; // redirect if login fails
  }
}
</script>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kitchen Screen | Orders</title>
  <link rel="stylesheet" href="/styles.css" />
  <style>
    body { background:#0b1220; color:#e6eefc; }
    .k-wrap { max-width: 1100px; margin: 40px auto; padding: 0 16px; }
    .k-head { display:flex; align-items:center; justify-content:space-between; margin-bottom: 16px; }
    .k-grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(280px,1fr)); gap:16px; }
    .k-card { background:#111a2e; border:1px solid #22304d; border-radius:12px; padding:16px; }
    .k-card h3 { margin:0 0 8px 0; }
    .k-items { font-size:14px; line-height:1.4; margin:8px 0; }
    .k-meta { font-size:12px; opacity:.85; }
    .btn { background:#22c55e; border:none; color:#07101e; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:700; }
    .btn[disabled] { opacity:.5; cursor:not-allowed; }
    .btn-logout { background:#ef4444; color:white; margin-left:8px; }
    #lastUpdated { font-size:12px; opacity:.7; margin-left:12px; }
  </style>
</head>
<body>
  <div class="k-wrap">
    <div class="k-head">
      <h1>Kitchen Orders</h1>
      <div>
        <button id="refresh" class="btn" title="Refresh">Refresh</button>
        <span id="lastUpdated"></span>
        <button onclick="logout()" class="btn btn-logout">Logout</button>
      </div>
    </div>
    <div id="orders" class="k-grid"></div>
  </div>

  <script>
    async function fetchKitchen() {
      try {
        const res = await fetch('/api/kitchen');
        const data = await res.json();
        const box = document.getElementById('orders');
        box.innerHTML = '';

        // üî• Hide completed orders
        data.orders
          .filter(o => o.status !== 'completed')
          .forEach(o => {
            const div = document.createElement('div');
            div.className = 'k-card';
            div.innerHTML = `
              <h3>Table ${o.table} ¬∑ <code>${o.orderId}</code></h3>
              <div class="k-items">
                ${o.items.map(it => `‚Ä¢ ${it.qty} √ó ${it.name} <span style="opacity:.7">(@ ‚Çπ${it.price})</span>`).join('<br/>')}
              </div>
              <div class="k-meta">Total: ‚Çπ${o.total} ¬∑ Status: ${o.status}</div>
              <div style="margin-top:10px">
                <button class="btn" onclick="markDone('${o.orderId}')">Mark Completed</button>
              </div>
            `;
            box.appendChild(div);
          });

        document.getElementById('lastUpdated').innerText =
          "Last Updated: " + new Date().toLocaleTimeString();

      } catch (err) {
        console.error("Error fetching kitchen orders:", err);
      }
    }

    async function markDone(id) {
      await fetch(`/api/kitchen/${id}/complete`, { method: 'POST' });
      fetchKitchen();
    }

    function logout() {
      localStorage.removeItem("kitchenAuth");
      window.location.href = "/";
    }

    // ‚úÖ Wait until DOM is ready
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById('refresh').addEventListener('click', fetchKitchen);
      fetchKitchen();
      setInterval(fetchKitchen, 5000);
    });
  </script>
</body>
</html>
